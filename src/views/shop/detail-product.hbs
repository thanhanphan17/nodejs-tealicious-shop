<html lang='zxx'>

<head>
    <meta charset='UTF-8' />
    <meta name='description' content='WanderStay' />
    <meta name='keywords' content='unica, creative' />
    <meta name='viewport' content='width=device-width, initial-scale=1.0' />
    <meta http-equiv='X-UA-Compatible' content='ie=edge' />
    <title>Yên Trà Quán</title>

    <!-- Google Font -->
    <link href='https://fonts.googleapis.com/css?family=Lora:400,700&display=swap' rel='stylesheet' />
    <link href='https://fonts.googleapis.com/css?family=Cabin:400,500,600,700&display=swap' rel='stylesheet' />

    <!-- Css Styles -->
    <link rel='stylesheet' href='/css/bootstrap.min.css' type='text/css' />
    <link rel='stylesheet' href='/css/font-awesome.min.css' type='text/css' />
    <link rel='stylesheet' href='/css/elegant-icons.css' type='text/css' />
    <link rel='stylesheet' href='/css/flaticon.css' type='text/css' />
    <link rel='stylesheet' href='/css/owl.carousel.min.css' type='text/css' />
    <link rel='stylesheet' href='/css/nice-select.css' type='text/css' />
    <link rel='stylesheet' href='/css/jquery-ui.min.css' type='text/css' />
    <link rel='stylesheet' href='/css/magnific-popup.css' type='text/css' />
    <link rel='stylesheet' href='/css/slicknav.min.css' type='text/css' />
    <link rel='stylesheet' href='/css/style.css' type='text/css' />
</head>

<body>
    <!-- Page Preloder -->
    <div id='preloder'>
        <div class='loader'></div>
    </div>

    <!-- Header Section Begin -->
    <header class='header-section header-normal'>
        <div class='top-nav'>
            <div class='container'>
                <div class='row'>
                    <div class='col-lg-6'></div>
                </div>
            </div>
        </div>
        <div class='menu-item'>
            <div class='container'>
                <div class='row'>
                    <div class='col-lg-2'>
                        <div class='logo'>
                            <a href='/'>
                                <img src='/img/logo.png' alt='' />
                            </a>
                        </div>
                    </div>
                    <div class='col-lg-10'>
                        <div class='nav-menu'>
                            <nav class='mainmenu'>
                                <ul>
                                    <li><a href='/'>Trang chủ</a></li>
                                    <li><a href='/about-us'>Về chúng tôi</a></li>
                                    <li class='active'>
                                        <a href='/pages?page=0'>Sản phẩm</a>
                                        <ul class='dropdown'>
                                            <li><a href='/phong-vi-yen-tra'>Phong Vị Yên Trà</a></li>
                                            <li><a href='/hoa-co-duong-tam'>Hoa Cỏ Dưỡng Tâm</a></li>
                                            <li><a href='/thao-moc-nhiet-doi'>Thảo Mộc Nhiệt Đới</a></li>
                                            <li><a href='/yen-an-ngu-tra'>Yên An Ngự Trà</a></li>
                                        </ul>
                                    </li>
                                    <li><a href='/contact'>Liên hệ</a></li>
                                    <li>
                                        <a href='/cart' style='color: #0650c2'><img href='/cart'
                                                style='color: #333333; width: 20px; ' src='/img/cart-shopping.svg'
                                                alt='' /></a>
                                    </li>
                                    {{#if isLoggedIn}}
                                    <li>
                                        <img style='color: #333333; width: 20px; ' src='/img/user-profile.svg' alt='' />
                                        {{customerName}}
                                        <ul class='dropdown'>
                                            <li><a href='/profile'><img style='width: 20px' src='/img/user.png' />
                                                    Trang cá nhân</a></li>
                                            <li><a href='/change-password'><img style='width: 20px'
                                                        src='/img/key.svg' />
                                                    Đổi mật khẩu</a></li>
                                            <li><a href='/logout'><img style='width: 20px' src='/img/log-out.svg' />
                                                    Đăng xuất</a></li>
                                        </ul>
                                    </li>
                                    {{else}}
                                    <li><a href='/login' style='color: #0650c2'>Đăng nhập</a></li>
                                    <li><a href='/sign-up' style='color: #0650c2'>Tạo tài khoản</a></li>
                                    {{/if}}
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- Header End -->

    <!-- Product Details Section Begin -->
    <section class='product-details spad-2'>
        <div class='container'>
            <div class='row'>
                <div class='col-lg-5 col-md-6'>
                    <div id='product-carousel' class='carousel slide' data-ride='carousel'>
                        <div class='carousel-inner border'>
                            <div class='carousel-item active'>
                                <img style='width: 100%' src={{product.product.image.url.[1]}} alt='Image' />
                            </div>
                            {{#each product.product.image.url}}
                            <div class='carousel-item'>
                                <img style='width: 100%' src={{this}} alt='Image' />
                            </div>
                            {{/each}}
                        </div>
                        <a class='carousel-control-prev' href='#product-carousel' data-slide='prev'>
                            <i class='fa fa-2x fa-angle-left text-dark'></i>
                        </a>
                        <a class='carousel-control-next' href='#product-carousel' data-slide='next'>
                            <i class='fa fa-2x fa-angle-right text-dark'></i>
                        </a>
                    </div>

                </div>

                <div class='col-lg-7 col-md-6'>
                    <div class='product__details__text'>
                        <h2 class='font-weight-semi-bold'><strong>{{product.product.name}}</strong></h2>
                        <div>
                            <br />
                            <h3 class='font-weight-semi-bold mb-4'>Giá: {{product.product.price}} VNĐ</h3>
                        </div>
                        <p><b>Mô tả:</b>
                            {{product.product.description}}</p>

                        <div class='row'>

                            <div style='margin-left: 15px' class='center-submit'>
                                <strong class='product-price'>Số lượng</strong>
                            </div>
                            <div class='col-md-2 mb-3 mb-md-0'>
                                <input style='text-align: center;' type='text' class='form-control py-3' id='coupon'
                                    name="quantityInput" value='1' />
                            </div>
                            <div class='col-md-6'>
                                <form action="/add-to-cart" method='post'>
                                    <input type="hidden" name="quantity" id="quantity" value=>
                                    <input type="hidden" name="productId" id="" value={{product.product.id}}>
                                    <button style='color:#333333, width=400' class='btn btn-primary px-3' type='submit'
                                        onclick="addToCart()">
                                        <i class='fa fa-shopping-cart mr-1'></i> Thêm vào giỏ hàng
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class='product-details spad'>
        <div class="container">
            <div class='row'>
                <div class='col-md-12'>
                    <div class='row px-xl-5'>
                        <div class='col'>
                            <div class='nav nav-tabs justify-content-center border-secondary mb-4'>
                                <a class='nav-item nav-link active' data-toggle='tab' href='#tab-pane-1'>
                                    <div style='text-align: center;' class='section-title'>
                                        <span>Mô tả sản phẩm</span>
                                    </div>
                                </a>
                                <a class='nav-item nav-link' data-toggle='tab' href='#tab-pane-2'>
                                    <div style='text-align: center;' class='section-title'>
                                        <span>Đổi trả - Công dụng</span>
                                    </div>
                                </a>
                                <a class='nav-item nav-link' data-toggle='tab' href='#tab-pane-3'>
                                    <div style='text-align: center;' class='section-title'>
                                        <span>Đánh giá sản phẩm ({{rating.length}})</span>
                                    </div>
                                </a>
                            </div>
                            <div class='tab-content'>

                                <div class='tab-pane fade show active' id='tab-pane-1'>
                                    <div class="row">
                                        <div class="col">
                                            <h4 class='mb-3'>Mô tả sản phẩm</h4>
                                            <p>
                                                Yên Trà Quán chuyên cung cấp các sản phẩm chăm sóc sắc đẹp và sức khỏe
                                                có
                                                thành
                                                phần từ thiên nhiên với công nghệ sản xuất khác biệt, trong đó có thể kể
                                                đến
                                                các
                                                sản phẩm như trà dưỡng tâm an thần, trà gừng đường nâu thảo mộc, trà
                                                dưỡng
                                                nhan,
                                                trà gạo lứt đậu đen, bột cần tây nguyên chất, bột củ sen ngũ cốc dinh
                                                dưỡng,…xuất xứ tự nhiên không chứa chất bảo quản, không hóa chất độc hại
                                                và
                                                rất
                                                lành tính.
                                                <br />
                                                Những nguyên liệu của Yên Trà Quán đều được tuyển chọn kỹ càng để có thể
                                                mang
                                                đến cho khách hàng trải những trải nghiệm tốt nhất!
                                                <br />
                                                ❖ Thương hiệu: Yên Trà Quán
                                                <br />
                                                ❖ Xuất xứ: Việt Nam
                                                <br />
                                                ❖ Định dạng: túi
                                                <br />
                                                ❖ Hạn sử dụng: 6 tháng
                                            </p>
                                        </div>
                                    </div>

                                </div>

                                <div class='tab-pane fade' id='tab-pane-2'>
                                    <div class="row">
                                        <div class="col">
                                            <div class='row'>
                                                <div class='col-md-6'>
                                                    <h4 class='mb-3'>Quy định đổi trả hàng</h4>

                                                    <ul class='list-group list-group-flush'>
                                                        <li class='list-group-item px-0'>
                                                            ❶ Điều kiện áp dụng (trong vòng 07 ngày kể từ
                                                            khi nhận sản phẩm) <br>
                                                            – Hàng hoá vẫn còn mới, chưa qua sử dụng<br>
                                                            – Hàng hoá bị lỗi hoặc hư hỏng do vận chuyển
                                                            hoặc do nhà sản xuất
                                                        </li>
                                                        <li class='list-group-item px-0'>
                                                            ❷ Trường hợp được chấp nhận<br>
                                                            – Hàng không đúng loại như quý khách đặt hàng<br>
                                                            – Không đủ số lượng như trong đơn hàng
                                                        </li>
                                                        <li class='list-group-item px-0'>
                                                            ❸ Trường hợp không đủ điều kiện áp dụng chính
                                                            sách<br>
                                                            – Quá 07 ngày kể từ khi Quý khách nhận hàng<br>
                                                            – Gửi lại hàng không đúng mẫu mã, không phải sản
                                                            phẩm của Yên Trà Quán
                                                        </li>
                                                    </ul>
                                                </div>
                                                <div class='col-md-6'>
                                                    <h4 class='mb-3'>Công dụng sản phẩm</h4>

                                                    <ul class='list-group list-group-flush'>
                                                        <li class='list-group-item px-0'>
                                                            Mộc Liên trà mang lại cảm giác thư thái, ngăn ngừa da bị lão
                                                            hóa,
                                                            sạm nám.
                                                        </li>
                                                        <li class='list-group-item px-0'>
                                                            Mộc Liên trà hỗ trợ điều trị thiếu máu, cải thiện giấc ngủ,
                                                            cải
                                                            thiện sức khỏe từ bên trong.
                                                        </li>
                                                        <li class='list-group-item px-0'>
                                                            Mộc Liên trà giúp tăng sức đề kháng, giảm béo, cải thiện
                                                            tuần
                                                            hoàn,
                                                            làm giảm các nguy cơ tắc nghẽn mạch
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class='tab-pane fade' id='tab-pane-3'>
                                    <div class='row'>
                                        <div class='col'>
                                            <div class="row">
                                                <div class='col-6'>
                                                    <div id="ratingsContainer">
                                                    </div>
                                                    <div id="r">
                                                        {{#each rating}}
                                                        <div class='media mb-4'>
                                                            <img src='/img/profile.jpg' alt='Image'
                                                                class='img-fluid mr-3 mt-1' style='width: 45px' />
                                                            <div class='media-body'>
                                                                <h6>
                                                                    {{this.user.name}}<small> -
                                                                        <i>{{this.createdAt}}</i></small>
                                                                </h6>
                                                                <div class='product__details__rating'
                                                                    data-value="{{this.rating}}">
                                                                </div>
                                                                <p>
                                                                    {{this.comment}}
                                                                </p>
                                                            </div>
                                                        </div>
                                                        {{/each}}
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <h4 class='mb-4'>Đánh giá sản phẩm</h4>
                                                    <form id="ratingForm">
                                                        <div class='form-group'>
                                                            <input type="hidden" name="productId" id=""
                                                                value={{product.product.id}}>
                                                            <label for='email'>Đánh giá sản phẩm *</label>
                                                            <div style='margin-left: 5px' class='row'>
                                                                <span class="star-rating">
                                                                    <input type="radio" name="rating" value="1"><i></i>
                                                                    <input type="radio" name="rating" value="2"><i></i>
                                                                    <input type="radio" name="rating" value="3"><i></i>
                                                                    <input type="radio" name="rating" value="4"><i></i>
                                                                    <input type="radio" name="rating" value="5"><i></i>
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <div class='form-group'>
                                                            <label for='message'>Bình luận của bạn *</label>
                                                            <textarea id='message' cols='20' rows='2'
                                                                class='form-control' name="comment"></textarea>
                                                        </div>

                                                        <button id="myButton" type="button"
                                                            class="btn btn-primary-hover-outline">Gửi đánh giá</button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class='product-section spad'>
        <div class='container'>
            <div class='row center-submit'>
                <div class='section-title'>
                    <span>Sản phẩm liên quan</span>
                </div>
            </div>
            <div class='row'>
                <div class='col-lg-12'>
                    <div class='section-title'>
                        <h2>Có thể bạn sẽ thích</h2>
                    </div>
                </div>
            </div>

            <div style='padding: 10px' class='row'>
                {{#each product.relatedProducts}}
                <div class='col-12 col-md-4 col-lg-3 mb-5 mb-md-0'>
                    <a class='product-item' href='/detail-product'>
                        <img src={{this.image.url.[0]}} class='img-fluid product-thumbnail' />
                        <h3 class='product-title'>{{this.name}}</h3>
                        <strong class='product-price'>{{this.price}} VNĐ</strong>

                        <span class='icon-cross'>
                            <img src='/img/cross.svg' class='img-fluid' />
                        </span>
                    </a>
                </div>
                {{/each}}
            </div>
        </div>
    </section>

    <!-- Product Details Section End -->
    <!-- Footer Section Begin -->
    <footer class='footer-section'>
        <div class='container'>
            <div class='footer-text'>
                <div class='row'>
                    <div class='col-lg-4'>
                        <div class='ft-about'>
                            <div class='logo'>
                                <a href='#'>
                                    <img class='img-logo' src='/img/logo.png' alt='' />
                                </a>
                            </div>
                            <p>
                                Yên Trà Quán với những tâm hồn tự tại đã trót yêu mẹ thiên nhiên say đắm, mong muốn
                                được dùng các loại thảo mộc chữa lành cho tất cả mọi người.
                            </p>
                        </div>
                    </div>
                    <div class='col-lg-3 offset-lg-1'>
                        <div class='ft-contact'>
                            <h6>Liên hệ</h6>
                            <ul>
                                <li>0123456789</li>
                                <li>yentraquan@gmail.com</li>
                                <li>227 Nguyen Van Cuu, Ward 4, <br />District 5, HCMc</li>
                            </ul>
                        </div>
                    </div>
                    <div class='col-lg-3 offset-lg-1'>
                        <div class='ft-newslatter'>
                            <h6>Thông tin mới nhất</h6>
                            <p>Cập nhật những ưu đãi và thông tin mới.</p>
                            <form action='#' class='fn-form'>
                                <input type='text' placeholder='Email' />
                                <button type='submit'><i class='fa fa-send'></i></button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class='copyright-option'>
            <div class='container'>
                <div class='row'>
                    <div class='col-lg-12'>
                        <ul>
                            <li><a href='#'>Chính sách bán hàng</a></li>
                            <li><a href='#'>Chính sách thanh toán</a></li>
                            <li><a href='#'>Chính sách bảo hành</a></li>
                            <li><a href='#'>Điều khoản dịch vụ</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- Footer Section End -->

    <!-- Js Plugins -->
    <script src='/js/jquery-3.3.1.min.js'></script>
    <script src='/js/bootstrap.min.js'></script>
    <script src='/js/jquery.magnific-popup.min.js'></script>
    <script src='/js/jquery.nice-select.min.js'></script>
    <script src='/js/jquery-ui.min.js'></script>
    <script src='/js/jquery.slicknav.js'></script>
    <script src='/js/owl.carousel.min.js'></script>
    <script src='/js/main.js'></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script>
        // Get the coupon input element
        const couponInput = document.getElementById('coupon');

        // Get the quantity input element
        const quantityInput = document.getElementById('quantity');

        // Add an event listener to the coupon input
        couponInput.addEventListener('input', function () {
            quantityInput.value = couponInput.value;
        });

        document.addEventListener('DOMContentLoaded', function () {
            const ratingContainers = document.querySelectorAll('.product__details__rating');

            ratingContainers.forEach(container => {
                const ratingValue = parseFloat(container.getAttribute('data-value'));
                displayStarRating(ratingValue, container);
            });

            function displayStarRating(numStars, container) {
                container.innerHTML = '';

                for (let i = 1; i <= 5; i++) {
                    const star = document.createElement('i');
                    star.classList.add('fa', i <= numStars ? 'fa-star' : 'fa-star-o');

                    if (i === Math.ceil(numStars) && numStars % 1 !== 0) {
                        star.classList.add('fa-star-half-o');
                    }

                    container.appendChild(star);
                }
            }
        });

        function uploadStarNumber() {
            const ratingContainers = document.querySelectorAll('.product__details__rating');

            ratingContainers.forEach(container => {
                const ratingValue = parseFloat(container.getAttribute('data-value'));
                displayStarRating(ratingValue, container);
            });

            function displayStarRating(numStars, container) {
                container.innerHTML = '';

                for (let i = 1; i <= 5; i++) {
                    const star = document.createElement('i');
                    star.classList.add('fa', i <= numStars ? 'fa-star' : 'fa-star-o');

                    if (i === Math.ceil(numStars) && numStars % 1 !== 0) {
                        star.classList.add('fa-star-half-o');
                    }

                    container.appendChild(star);
                }
            }
        }

        $(document).ready(function () {
            $('#myButton').on('click', function () {
                updateDOMWithRatings();
                submitForm()
            });
        });

        function updateDOMWithRatings() {
            var ratingsContainer = $("#ratingsContainer");
            ratingsContainer.empty(); // Clear existing content

            var formData = $('#ratingForm').serialize();
            console.log(formData);

            var rating = formData.match(/rating=([^&]+)/)[1];
            var comment = decodeURIComponent(formData.match(/comment=([^&]+)/)[1]);

            console.log("Rating:", rating);
            console.log("Comment:", comment);

            // Use JavaScript variables directly in the template
            var newRatingHTML = `
                                <div class='media mb-4'>
                                    <img src='/img/profile.jpg' alt='Image' class='img-fluid mr-3 mt-1' style='width: 45px' />
                                    <div class='media-body'>
                                        <h6>{{customerName}}<small> - <i>${new Date().toLocaleString()}</i></small></h6>
                                        <div class='product__details__rating' data-value="${rating}}"></div>
                                        <p>${comment}</p>
                                    </div>
                                </div>`;

            ratingsContainer.append(newRatingHTML);
            uploadStarNumber()
        }



        function submitForm() {
            var formData = $('#ratingForm').serialize();
            $.ajax({
                type: 'POST',
                url: '/rating',
                data: formData,
                success: function (response) {
                    console.log(response);
                },
                error: function (error) {
                    console.error('Error:', error);
                }
            });
        }

        function addToCart() {
            // Get the value from the "quantityProduct" input field
            var quantityProductValue = document.getElementById('coupon').value;

            // Set the value to the hidden input field "quantity"
            document.getElementById('quantity').value = quantityProductValue;

        }
    </script>
</body>

</html>